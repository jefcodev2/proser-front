<!-- ============================================================== -->
<!-- Bread crumb and right sidebar toggle -->
<!-- ============================================================== -->
<div class="page-breadcrumb">
  <div class="row">
    <div class="col-5 align-self-center">
      <h4 class="page-title">Dashboard | Telefónica</h4>
    </div>
    <div class="col-7 align-self-center">
      <div class="d-flex align-items-center justify-content-end">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item">
              <a href="#">Home</a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">Dashboard | Telefónica</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
</div>
<!-- ============================================================== -->
<!-- End Bread crumb and right sidebar toggle -->
<!-- ============================================================== -->
<!-- ============================================================== -->
<!-- Container fluid  -->
<!-- ============================================================== -->
<div class="container-fluid">
  <!-- ============================================================== -->
  <!-- Sales chart -->
  <!-- ============================================================== -->
  <div class="card-group">
    <div class="card">
      <div class="card-body">
        <div class="row">
          <div class="col-md-12">
            <div class="d-flex no-block align-items-center">
              <div>
                <i class="ri-emotion-line fs-6 text-muted"></i>
                <p class="fs-4 mb-1">Establecimientos/p></p>
              </div>

              <div class="ms-auto">
                <h1 class="fw-light text-end">23</h1>
              </div>
            </div>
          </div>
          <div class="col-12">
            <div class="progress">
              <div
                class="progress-bar bg-info"
                role="progressbar"
                style="width: 75%; height: 6px"
                aria-valuenow="25"
                aria-valuemin="0"
                aria-valuemax="100"
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Column -->
    <!-- Column -->
    <div class="card">
      <div class="card-body">
        <div class="row">
          <div class="col-md-12">
            <div class="d-flex no-block align-items-center">
              <div>
                <i class="ri-image-fill fs-6 text-muted"></i>
                <p class="fs-4 mb-1">Encuestas</p>
              </div>
              <div class="ms-auto">
                <h1 class="fw-light text-end">169</h1>
              </div>
            </div>
          </div>
          <div class="col-12">
            <div class="progress">
              <div
                class="progress-bar bg-success"
                role="progressbar"
                style="width: 60%; height: 6px"
                aria-valuenow="25"
                aria-valuemin="0"
                aria-valuemax="100"
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Column -->
    <!-- Column -->
    <div class="card">
      <div class="card-body">
        <div class="row">
          <div class="col-md-12">
            <div class="d-flex no-block align-items-center">
              <div>
                <i class="ri-money-euro-circle-line fs-6 text-muted"></i>
                <p class="fs-4 mb-1">Provincias</p>
              </div>
              <div class="ms-auto">
                <h1 class="fw-light text-end">157</h1>
              </div>
            </div>
          </div>
          <div class="col-12">
            <div class="progress">
              <div
                class="progress-bar bg-purple"
                role="progressbar"
                style="width: 65%; height: 6px"
                aria-valuenow="25"
                aria-valuemin="0"
                aria-valuemax="100"
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Column -->
    <!-- Column -->
    <div class="card">
      <div class="card-body">
        <div class="row">
          <div class="col-md-12">
            <div class="d-flex no-block align-items-center">
              <div>
                <i class="ri-bar-chart-fill fs-6 text-muted"></i>
                <p class="fs-4 mb-1">Tamaño de Local</p>
              </div>
              <div class="ms-auto">
                <h1 class="fw-light text-end">236</h1>
              </div>
            </div>
          </div>
          <div class="col-12">
            <div class="progress">
              <div
                class="progress-bar bg-danger"
                role="progressbar"
                style="width: 70%; height: 6px"
                aria-valuenow="25"
                aria-valuemin="0"
                aria-valuemax="100"
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ============================================================== -->
  <!-- Filtros en Grid de 4 columnas -->
  <!-- ============================================================== -->
  <div class="card mb-4">
    <div class="card-body">
      <h4 class="card-title">Filtros de Búsqueda</h4>
      <h6 class="card-subtitle lh-base mb-4">Selecciona los criterios para filtrar los datos del dashboard</h6>

      <!-- Primera fila de filtros -->
      <div class="row mb-3">
        <div class="col-md-3">
          <label class="form-label">Provincia</label>
          <select class="select2 form-control custom-select" style="width: 100%; height: 36px">
            <option>Seleccionar</option>
            <option value="chimborazo">Chimborazo</option>
            <option value="cotopaxi">Cotopaxi</option>
            <option value="esmeraldas">Esmeraldas</option>
            <option value="guayas">Guayas</option>
            <option value="manabi">Manabi</option>
            <option value="pichincha">Pichincha</option>
            <option value="santo-domingo">Santo Domingo</option>
            <option value="tungurahua">Tungurahua</option>
          </select>
        </div>

        <div class="col-md-3">
          <label class="form-label">Tipo Encuesta</label>
          <select class="select2 form-control custom-select" style="width: 100%; height: 36px">
            <option>Seleccionar</option>
            <option value="censo">Censo</option>
            <option value="colocacion">Colocación</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Mes</label>
          <select class="select2 form-control custom-select" style="width: 100%; height: 36px">
            <option>Seleccionar</option>
            <option value="febrero">Febrero</option>
            <option value="marzo">Marzo</option>
            <option value="abril">Abril</option>
            <option value="mayo">Mayo</option>
            <option value="junio">Junio</option>
            <option value="julio">Julio</option>
            <option value="agosto">Agosto</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Tamaño de Local</label>
          <select class="select2 form-control custom-select" style="width: 100%; height: 36px">
            <option>Seleccionar</option>
            <option value="pequeño">Pequeño</option>
            <option value="mediano">Mediano</option>
            <option value="grande">Grande</option>
          </select>
        </div>

        <!-- Segunda fila de filtros -->
        <div class="row mb-4">
          <div class="col-md-3">
            <label class="form-label">Elementos Colocados</label>
            <div class="dropdown">
              <button
                class="btn btn-outline-secondary dropdown-toggle w-100 text-start position-relative"
                type="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                (click)="toggleElementosDropdown()"
                style="height: 36px; text-align: left"
              >
                {{ getElementosSeleccionadosText() }}
                <span
                  *ngIf="elementosSeleccionados.length > 0"
                  class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-primary"
                  style="font-size: 0.75em"
                >
                  {{ elementosSeleccionados.length }}
                </span>
              </button>
              <ul class="dropdown-menu w-100" [class.show]="elementosDropdownOpen">
                <li *ngFor="let elemento of elementosDisponibles">
                  <label class="dropdown-item d-flex align-items-center">
                    <input
                      type="checkbox"
                      class="form-check-input me-2"
                      [checked]="elementosSeleccionados.includes(elemento.value)"
                      (change)="toggleElementoSeleccionado(elemento.value)"
                    />
                    {{ elemento.label }}
                  </label>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <button class="dropdown-item text-center" (click)="limpiarElementosSeleccionados()">
                    Limpiar Selección
                  </button>
                </li>
              </ul>
            </div>
          </div>

          <div class="col-md-3">
            <label class="form-label">Tipo de Negocio</label>
            <select class="select2 form-control custom-select" style="width: 100%; height: 36px">
              <option>Seleccionar</option>
              <option value="activo">Farmacia</option>
              <option value="inactivo">Ferretería</option>
              <option value="pendiente">Panadería</option>
              <option value="cancelado">Tienda de barrio</option>
              <option value="cancelado">Veta de celulares</option>
              <option value="cancelado">Cyber/cabinas</option>
              <option value="cancelado">Bazar/papeleria</option>
              <option value="cancelado">Otros</option>
            </select>
          </div>

          <div class="col-md-3">
            <label class="form-label">Geo Área</label>
            <select class="select2 form-control custom-select" style="width: 100%; height: 36px">
              <option>Seleccionar</option>
              <option value="ambato">Ambato</option>
              <option value="riobamba">Riobamba</option>
              <option value="guaranda">Guaranda</option>
              <option value="la-joya">La Joya</option>
              <option value="la-perla">La Perla</option>
            </select>
          </div>

          <div class="col-md-3">
            <label class="form-label">Acciones</label>
            <div class="d-grid gap-2">
              <button class="btn btn-outline-secondary" type="button" (click)="limpiarFiltros()">Limpiar</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <!-- Nav tabs -->
      <ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
          <a class="nav-link d-flex active" data-bs-toggle="tab" href="#home2" role="tab">
            <span><i class="ti-home"></i> </span>
            <span class="d-none d-md-block ms-2">General</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link d-flex" data-bs-toggle="tab" href="#profile2" role="tab">
            <span><i class="ti-user"></i> </span>
            <span class="d-none d-md-block ms-2">Chips</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link d-flex" data-bs-toggle="tab" href="#messages2" role="tab">
            <span><i class="ti-email"></i> </span>
            <span class="d-none d-md-block ms-2">Recargas</span>
          </a>
        </li>
      </ul>
      <!-- Tab panes -->
      <div class="tab-content">
        <div class="tab-pane active" id="home2" role="tabpanel">
          <div class="p-3">
            <h3>General</h3>
            <h4>you can use it with the small code</h4>
            <!-- ============================================================== -->
            <!-- Gráficos de Barras -->
            <!-- ============================================================== -->
            <div class="row mb-4">
              <!-- Gráfico de Colocación por Provincia -->
              <div class="col-lg-6">
                <div class="card">
                  <div class="card-body">
                    <h4 class="card-title">COLOCACIÓN PROVINCIA</h4>
                    <h6 class="card-subtitle lh-base mb-4">Distribución de encuestas por provincia</h6>

                    <div class="chart-container" style="position: relative; height: 400px">
                      <canvas #provinciaChart></canvas>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Gráfico de Tamaño de Local -->
              <div class="col-lg-6">
                <div class="card">
                  <div class="card-body">
                    <h4 class="card-title">TAMAÑO DE LOCAL</h4>
                    <h6 class="card-subtitle lh-base mb-4">Distribución por tamaño de establecimiento</h6>

                    <div class="chart-container" style="position: relative; height: 400px">
                      <canvas #tamanoChart></canvas>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Gráfico de Tipo de Negocio -->
              <div class="col-lg-12">
                <div class="card">
                  <div class="card-body">
                    <h4 class="card-title">TIPO DE NEGOCIO</h4>
                    <h6 class="card-subtitle lh-base mb-4">Distribución por tipo de establecimiento</h6>

                    <div class="chart-container" style="position: relative; height: 400px">
                      <canvas #tipoNegocioChart></canvas>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Gráfico de Elementos Colocados -->
              <div class="col-lg-12">
                <div class="card">
                  <div class="card-body">
                    <h4 class="card-title">ELEMENTOS COLOCADOS DURANTE LA VISITA</h4>
                    <h6 class="card-subtitle lh-base mb-4">Distribución de elementos colocados durante las visitas</h6>

                    <div class="chart-container" style="position: relative; height: 400px">
                      <canvas #elementosColocadosChart></canvas>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="tab-pane p-3" id="profile2" role="tabpanel">
          <h3>Análisis de Chips y Operadoras</h3>
          <h4>Distribución de operadoras y precios de compra/venta</h4>

          <!-- Gráfico principal de OPERADORA CHIP -->
          <div class="row mb-4">
            <div class="col-12">
              <div class="card">
                <div class="card-body">
                  <h4 class="card-title">OPERADORA CHIP</h4>
                  <h6 class="card-subtitle lh-base mb-4">Distribución de combinaciones de operadoras</h6>

                  <div class="chart-container" style="position: relative; height: 400px">
                    <canvas #operadoraChipChart></canvas>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Gráficos de precios por operadora -->
          <div class="row mb-4">
            <!-- MOVISTAR -->
            <div class="col-lg-6 mb-4">
              <div class="card border-success">
                <div class="card-header bg-success text-white">
                  <h5 class="mb-0">MOVISTAR</h5>
                </div>
                <div class="card-body">
                  <div class="row">
                    <!-- Precio Compra Movistar -->
                    <div class="col-md-6">
                      <h6 class="text-success">PRECIO COMPRA</h6>
                      <div class="chart-container" style="position: relative; height: 200px">
                        <canvas #precioCompraMovistarChart></canvas>
                      </div>
                    </div>
                    <!-- Precio Venta Movistar -->
                    <div class="col-md-6">
                      <h6 class="text-success">PRECIO VENTA</h6>
                      <div class="chart-container" style="position: relative; height: 200px">
                        <canvas #precioVentaMovistarChart></canvas>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- TUENTI -->
            <div class="col-lg-6 mb-4">
              <div class="card border-info">
                <div class="card-header bg-info text-white">
                  <h5 class="mb-0">TUENTI</h5>
                </div>
                <div class="card-body">
                  <div class="row">
                    <!-- Precio Compra Tuenti -->
                    <div class="col-md-6">
                      <h6 class="text-info">PRECIO COMPRA</h6>
                      <div class="chart-container" style="position: relative; height: 200px">
                        <canvas #precioCompraTuentiChart></canvas>
                      </div>
                    </div>
                    <!-- Precio Venta Tuenti -->
                    <div class="col-md-6">
                      <h6 class="text-info">PRECIO VENTA</h6>
                      <div class="chart-container" style="position: relative; height: 200px">
                        <canvas #precioVentaTuentiChart></canvas>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- CLARO -->
            <div class="col-lg-6 mb-4">
              <div class="card border-danger">
                <div class="card-header bg-danger text-white">
                  <h5 class="mb-0">CLARO</h5>
                </div>
                <div class="card-body">
                  <div class="row">
                    <!-- Precio Compra Claro -->
                    <div class="col-md-6">
                      <h6 class="text-danger">PRECIO COMPRA</h6>
                      <div class="chart-container" style="position: relative; height: 200px">
                        <canvas #precioCompraClaroChart></canvas>
                      </div>
                    </div>
                    <!-- Precio Venta Claro -->
                    <div class="col-md-6">
                      <h6 class="text-danger">PRECIO VENTA</h6>
                      <div class="chart-container" style="position: relative; height: 200px">
                        <canvas #precioVentaClaroChart></canvas>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- CNT -->
            <div class="col-lg-6 mb-4">
              <div class="card border-primary">
                <div class="card-header bg-primary text-white">
                  <h5 class="mb-0">CNT</h5>
                </div>
                <div class="card-body">
                  <div class="row">
                    <!-- Precio Compra CNT -->
                    <div class="col-md-6">
                      <h6 class="text-primary">PRECIO COMPRA</h6>
                      <div class="chart-container" style="position: relative; height: 200px">
                        <canvas #precioCompraCntChart></canvas>
                      </div>
                    </div>
                    <!-- Precio Venta CNT -->
                    <div class="col-md-6">
                      <h6 class="text-primary">PRECIO VENTA</h6>
                      <div class="chart-container" style="position: relative; height: 200px">
                        <canvas #precioVentaCntChart></canvas>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="tab-pane p-3" id="messages2" role="tabpanel">
          <h3>Análisis de Recargas</h3>
          <h4>Distribución de operadoras de recargas y tipos de negocio</h4>

          <!-- Gráfico de OPERADORA RECARGAS -->
          <div class="row mb-4">
            <div class="col-12">
              <div class="card">
                <div class="card-body">
                  <h4 class="card-title">OPERADORA RECARGAS</h4>
                  <h6 class="card-subtitle lh-base mb-4">Distribución de operadoras de recargas</h6>

                  <div class="chart-container" style="position: relative; height: 400px">
                    <canvas #operadoraRecargasChart></canvas>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Gráfico de TIPO DE NEGOCIO -->
          <div class="row mb-4">
            <div class="col-12">
              <div class="card">
                <div class="card-body">
                  <h4 class="card-title">TIPO DE NEGOCIO</h4>
                  <h6 class="card-subtitle lh-base mb-4">Distribución por tipo de establecimiento</h6>

                  <div class="chart-container" style="position: relative; height: 400px">
                    <canvas #tipoNegocioRecargasChart></canvas>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <h4 class="card-title">Encuestas Telefónicas</h4>
      <h6 class="card-subtitle lh-base">
        Using the most basic table Leanne Grahamup, here’s how .table-based tables look in Bootstrap. You can use any
        Listado de todas las encuestas realizadas a establecimientos
      </h6>
    </div>
    <div class="table-responsive">
      <table class="table customize-table mb-0 v-middle">
        <thead class="table-light">
          <tr>
            <th class="border-bottom border-top">Código</th>
            <th class="border-bottom border-top">Establecimiento</th>
            <th class="border-bottom border-top">Tipo Negocio</th>
            <th class="border-bottom border-top">Provincia</th>
            <th class="border-bottom border-top">Vende Chips</th>
            <th class="border-bottom border-top">Vende Recargas</th>
            <th class="border-bottom border-top">Fecha</th>
            <th class="border-bottom border-top">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let encuesta of encuestas">
            <td>
              <span class="fw-bold text-primary">{{ encuesta.codigo }}</span>
            </td>
            <td>
              <div class="d-flex align-items-center">
                <div class="me-3">
                  <i class="ri-store-2-line fs-4 text-muted"></i>
                </div>
                <div>
                  <h6 class="mb-0 fw-normal">{{ encuesta.nombre }}</h6>
                  <small class="text-muted">{{ encuesta.grupo_negocio }}</small>
                </div>
              </div>
            </td>
            <td>
              <span class="badge bg-light-info text-info">{{ encuesta.tipo_negocio }}</span>
            </td>
            <td>
              <div>
                <strong>{{ encuesta.provincia }}</strong
                ><br />
                <small class="text-muted">{{ encuesta.canton }}, {{ encuesta.parroquia }}</small>
              </div>
            </td>
            <td>
              <span *ngIf="encuesta.vende_chips === 'Sí'" class="badge bg-light-success text-success">
                <i class="ri-check-line me-1"></i>Sí
              </span>
              <span *ngIf="encuesta.vende_chips !== 'Sí'" class="badge bg-light-danger text-danger">
                <i class="ri-close-line me-1"></i>No
              </span>
            </td>
            <td>
              <span *ngIf="encuesta.vende_recargas === 'Sí'" class="badge bg-light-success text-success">
                <i class="ri-check-line me-1"></i>Sí
              </span>
              <span *ngIf="encuesta.vende_recargas !== 'Sí'" class="badge bg-light-danger text-danger">
                <i class="ri-close-line me-1"></i>No
              </span>
            </td>
            <td>
              <small class="text-muted">{{ formatearFecha(encuesta.fecha) }}</small>
            </td>
          </tr>

          <tr *ngIf="encuestas.length === 0 && !loading">
            <td colspan="8" class="text-center py-4">
              <i class="ri-file-list-3-line fs-1 text-muted"></i>
              <p class="mt-2 mb-0 text-muted">No hay encuestas disponibles</p>
            </td>
          </tr>

          <!-- Estado de carga -->
          <tr *ngIf="loading">
            <td colspan="8" class="text-center py-4">
              <i class="ri-loader-4-line fs-1 text-muted"></i>
              <p class="mt-2 mb-0 text-muted">Cargando encuestas...</p>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ============================================================== -->
  <!-- End Container fluid  -->
  <!-- ============================================================== -->
  <!-- ============================================================== -->
  <!-- footer -->
  <!-- ============================================================== -->
  <footer class="footer text-center">All Rights Reserved by Nice admin</footer>
  <!-- ============================================================== -->
  <!-- End footer -->
  <!-- ============================================================== -->
</div>

<style>
  .dropdown-menu.show {
    display: block !important;
  }

  .dropdown-item:hover {
    background-color: #f8f9fa;
  }

  .dropdown-item input[type='checkbox'] {
    margin-right: 8px;
  }

  .dropdown-item label {
    cursor: pointer;
    margin-bottom: 0;
    width: 100%;
  }

  .dropdown-item button {
    border: none;
    background: none;
    width: 100%;
    text-align: center;
    color: #6c757d;
  }

  .dropdown-item button:hover {
    background-color: #f8f9fa;
    color: #495057;
  }
</style>
